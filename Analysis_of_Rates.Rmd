---
title: "Analysis of Opioid Prescription, Poverty, and Suicide Rates"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(infer)
library(moderndive)
```

***This is an example problem***

A [recent NPR article](https://www.npr.org/2020/07/17/887590699/doctors-and-dentists-still-flooding-u-s-with-opioid-prescriptions) noted that the U.S. is still being flooded with prescription opioid prescriptions by doctors and dentists. Upon reading the article, a friend pondered what the provided heat map for prescriptions would look like overlaid with suicide and poverty rates. This prompted the question "Is a larger rate of legal opioid prescription related to a higher rate of suicides and poverty?"  

To test the conjecture, we found data from the CDC in relation to [suicide rates by county](https://wisqars.cdc.gov:8443/cdcMapFramework/mapModuleInterface.jsp), [poverty rates by county](https://data.hrsa.gov/tools/data-explorer?ds=29,34), and [opioid prescription rate per county](https://www.cdc.gov/drugoverdose/maps/rxrate-maps.html). The suicide rate averages were calculated per 100,000 people between 2008 and 2014. Poverty rates are percentages of families below the Federal Poverty Level between 2014 and 2018. The opioid prescription rate averages were calculated per 100 people between 2005 and 2015.  

# Check Problem Set 10 and Lab 11 for references to regression, correlation, and generating samples.

What we can calculate: (This is two+ quantitative variables)
 - proportion of suicides and opioid prescriptions by county population
 - parameter of interest is regression slope $\beta$ and correlation $R$
 - distribution statistic $\hat{\beta}$
    - approximate $t$ value
    - standard error
Infer confidence interval to estimate $\beta_1$
 - data %>% specify(suicide ~ opioid) %>%
 - hypothesize(null = "independence") %>%
 - generate(reps = 1000, type = "permute") %>%
 - calculate(stat = "slope") %>%
 - get_p_value(obs_stat = beta_1, direction = "both")
 
Regression models
  it is only appropriate to make predictions based on a regression model if:
    
  1. The data should show a linear trend.
  
  2. The distribution of residuals is approximately Normal.
  
  3. The residuals have constant variability.
  
# below is mostly the example, but above is the basic format for how we'll do this thing.

```{r message = FALSE, warning = FALSE}
# Read in data
spo_rate <- read_csv('https://raw.githubusercontent.com/qiqiliang/statistics/master/US_Suicide_Poverty_Opioid_Prescription_Rates') %>%
  select(-X1)
```


*********************************************************************************
Null Hypothesis: There no correlation between suicide, poverty, and opioid prescription rates.
$$H_0: \quad \beta_S = \beta_P = \beta_O = 0$$
Alternate Hypothesis:  There is correlation between suicide, poverty, and opioid prescription rates. 



*********************************************************************************

b. State what a Type I error and a Type II error represent in the context of the problem.

*********************************************************************************
<!--  A Type I error represents tea and coffee having the same effects on the immune system but researchers saying otherwise due to an unlikely event in which tea and coffee showed having different effects on the immune system.   -->
<!--  A Type II error would be when tea and coffee actually have different effects on the immune system, but researchers did not reject the null hypothesis because unlikely events do occur.  -->



*********************************************************************************


c. Construct a graphic and compute summary statistics to explore the sample data.  Draw some initial conclusions based on your graph and summary statistics.



*********************************************************************************
```{r}
# ggplot(spo_rate, aes(x = avg_suicide_rate))+
#   geom_bar()
# 
# ggplot(spo_rate, aes(x = avg_prescr_rate))+
#   geom_bar()

ggplot(spo_rate, aes(x = Avg_Prescr_Rate, y = Avg_Suicide_Rate)) +
  geom_point(alpha = 0.3)+
  geom_smooth(method = lm, se = FALSE) 
m_so <- lm(Avg_Suicide_Rate ~ Avg_Prescr_Rate, data = spo_rate)
get_regression_table(m_so)
summary(m_so)
```
Opioid prescription rate may be a statistically significant predictor of suicide rate as the p value calculated is less than the significance level $\alpha = 0.05$. The linear model, however, does not seems to be too practical, as the adjusted $R^2$ value is only 0.0329. 



*********************************************************************************


d. Generate a null distribution.

*********************************************************************************
```{r}
# null_immune_samples <- immune %>%
#   specify(response = InterferonGamma, explanatory = Drink) %>%
#   hypothesize(null = "independence") %>%
#   generate( reps = 10000, type = "permute")
# null_diff_means <- null_immune_samples %>% 
#   calculate(stat = "diff in means", order = c("Tea", "Coffee"))
# null_diff_means %>%
#   visualize()+
#   shade_p_value(obs_stat = obs_diff_immune, direction = "right")
```


*********************************************************************************
 

e. Compute the p-value and make a conclusion about your original hypotheses.

*********************************************************************************
```{r}
# null_diff_means %>%
#   get_p_value(obs_stat = obs_diff_immune, direction = "right")
```
Because the P value is less than alpha = 0.05, we can reject the null hypothesis 


*********************************************************************************



More questions to ask:
 - Demographics????
    - Ethnicity, Income
    - Targeting marginalized communities?
